# build 6
- [Релиз #6](https://redmine.tamashi.games/issues/6747). ET: 6/9/12. Spent: 12h
- [Загрузка конфига игры из стороннего источника](https://redmine.tamashi.games/issues/6412). ET: 4/6/8. Spent: 2h40m. **wip**
---
# General
- wip: Добавлена поддержка формул в раздел конфига `psources`
# devpanel
- Добавлена библиотека [tweakpane](https://cocopon.github.io/tweakpane/) - меню для управления dev функциями в игре. "Панель разработчика".
- В панель разработчика добавлен флаг `devmode`. Добавлен режим работы приложения "`devmode`".
	- В режиме разработчика отключается требование на покупку всех этажей для старта спринта.
- В панель разработчика добавлены "пресеты" - кнопки, выставляющие игру в определенное состояние.
	- Добавлен пресет `Initial` - сброс игры к стартовому состоянию.
	- Добавлен персет `Preset 1` - открываются 6 этажей, все менеджеры; один менеджер ставится на этаж; добавляется 99999999 gold, gems и coffee.
- В панель разработчика добавлен флаг "remote config" и поле "config url". При переключении флага конфигурация загружается по пути config url.
# Бой ("Спринты")
## core
- Step rate боя изменен с 1s до 16ms
- Step rate регенерации здоровья менеджеров изменен с 1s до 16ms
- Механика атак изменена: вместо ежесекундного вычисления урона наносится урон с частотой, задаваемой `attackRate`  (в ms)
- На этаже не может быть более 1 таска из каждого спринта
- Таски всегда сортируются сначала по номеру таска в спринте от меньшего к большему слева направо, внутри одинакового номера таска - по номеру спринта, к которому принадлежит таск, слева направо.
- Клик по этажу в любом месте наносит урон переднему юниту
## config
- В раздел конфига pools добавлено поле `sprints_pool` — список спринтов. Каждый элемент списка - id `pool`'а, в котором перечислены id `tasks`. 
- Для каждого спринта юниты генерируются по списку из соответсвующего `pool`. В случае, когда порядковый номер спринта больше длины списка `sprints_pool` берется последний возможный id.
- Добавлена поддержка формул в раздел конфига `tasks`
- Для каждого генерируемого таска значение поля level выставляется в соответствии с порядковым номером спринта.
- Тестовое: для поля tasks.healthMax выставлено значение `@fn: 100 + level * 1` — читай "каждый уровень спринта прибавляется 1 hp юнита"  
- Добавлено поле `psources.clickDamage` с тестовым значением `@fn: 10 + level * 1`
## misc
- С момента начала боя и до окончания боя деактивируются следующие элементы UI: Кнопка инициализации боя, Кнопка перехода в кабинет босса, Кнопка перехода в отдел кадров, Кнопки переключения между этажами, Кнопки переключения между локациями, Кнопка PvP-боя.
- Для запуска спринта требуется: полное открытие этажей в локации, хотя бы на одном из активных этажей данной локации выставлен менеджер. Если требования не выполнены, выводится сообщение: "Не все требования выполнены:", "Необходимо приобрести все этажи этой локации.", "Необходимо назначить хотя бы одного менеджера."