# build 7
[Способности оборудования, триггеры. ГДД r1.5](https://redmine.tamashi.games/issues/6754). ET: 10/15/20=15. Spent: 16h

---

# devpanel
- Preset 1 дополнен - открывается все оборудование, один гаджет устанавливается на этаж
# code
- Добавлен `StringCodeExecutor` - класс для отработки кода из строк. Добавлен для обработки логики триггеров.
# config
- Добавлено поле `gadgets.chargesMax` - максимальное кол-во зарядов оборудования.
- Добавлены поля `gadgets.effectType`, `gadgets.effectValue`. 
- Для поля `gadgets.effectType` доступны значения: `heal`, `attack`, `poison`, `boost`, `slowdown`, `freeze`.
- Для поля `gadgets.effectValue`:
	- `heal`: абсолютное значение (Прим.: `100`)
	- `attack`: абсолютное значение (Прим.: `100`)
	- `poison`: три значения через запятую. Урон, частота (в секундах), продолжительность (в секундах) (Прим.: `100,0.5,10` будет 10сек наносить 100 урона каждые полсекунды)
	- `boost`: два значения через запятую. Множитель скорости атак менеджера, продолжительность (в секундах) (Прим.: `10,10` увеличивает скорость атаки в 10 раз на 10 сек)
	- `slowdown`: два значения через запятую. Делитель скорости атак юнитов, продолжительность (в секундах) (Прим.: `10,10` уменьшает скорость атаки юнитов в 10 раз на 10 сек)
- Добавлено поле `gadgets.triggers`. Содержимое поля - js код. (Пример: `here.employeeHealth <= 0.5 || here.enemiesTotalDamage > 1000`)
- Добавлено поле `gadgets.regenRate` - частота восстановления зарядов вне боя. Задается в секундах

# "Оборудование"
- Добавлен счетчик зарядов оборудования
- Добавлена кнопка перезарядки оборудования
- Добавлена логика восстанавления зарядов вне боя
## Триггеры
Для конфигурации триггеров добавлены следующие значения:
- `employeeHealth`. "Процент здоровья менеджера на этаже". Значение `0-1` где `1` - полное здоровье. 
- `enemiesTotalDamage`. "Враги суммарно нанесли X урона на этаже". Абсолютное значение. Сбрасывается при срабатывании триггера.
- `employeeTotalDamage`. "Менеджер суммарно нанёс X урона на этаже". Абсолютное значение. Сбрасывается при срабатывании триггера.
- `enemiesKilled`. "На этаже убито X юнитов". Абсолютное значение. Сбрасывается при срабатывании триггера.
- `enemiesHitsMade`. "Враги суммарно нанесли X ударов на этаже". Абсолютное значение. Сбрасывается при срабатывании триггера.
- `employeeHitsMade`. "Менеджер суммарно нанес X ударов на этаже". Абсолютное значение. Сбрасывается при срабатывании триггера.
- `enemiesLeftTotal`. "Всего в спринтах осталось X тасков". Абсолютное значение.
- `battleDuration`. "Время с появления первого таска на этаже". Значение в секундах.

## Способности
- Лечебное (`heal`): Восстанавливает X здоровья менеджеру на этаже.
- Атакующее (`attack`): Наносит X повреждений всем юнитам на этаже.
- Отравляющее (`poison`): С момента срабатывания тригера N секунд наносит X урона с частотой F
- Ускоряющее (`boost`): С момента срабатывания на N секунд уменьшает `attackRate` менеджера в X раз
-  Замедляющее (`slowdown`): С момента срабатывания на N секунд уменьшает `attackRate` юнитов в X раз
- Замораживающее (`freeze`): С момента срабатывания на N секунд отключает атаки юнитов
